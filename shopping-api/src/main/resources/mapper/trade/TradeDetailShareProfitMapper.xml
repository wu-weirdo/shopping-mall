<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.edaochina.shopping.api.dao.trade.TradeDetailShareProfitMapper">
    <resultMap id="BaseResultMap" type="com.edaochina.shopping.domain.entity.trade.TradeDetailShareProfit">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="order_id" property="orderId" jdbcType="VARCHAR"/>
        <result column="user_type" property="userType" jdbcType="TINYINT"/>
        <result column="user_id" property="userId" jdbcType="VARCHAR"/>
        <result column="share_profit" property="shareProfit" jdbcType="DECIMAL"/>
        <result column="to_account_money" property="toAccountMoney" jdbcType="DECIMAL"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>


    <resultMap id="SysShareProfitVoMap" type="com.edaochina.shopping.domain.vo.trade.SysShareProfitVo">
        <result column="id" property="id"/>
        <result column="order_id" property="orderId"/>
        <result column="merchant_id" property="merchantId"/>
        <result column="goods_name" property="goodsName"/>
        <result column="buy_num" property="buyNum"/>
        <result column="goods_type" property="goodsType"/>
        <result column="order_price" property="orderPrice"/>
        <result column="profit_free" property="profitFree"/>
        <result column="profit_time" property="profitTime"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="share_merchant_id" property="shareMerchantId"/>
    </resultMap>


    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, order_id, user_type, user_id, share_profit, to_account_money, create_time, update_time
    </sql>
    <select id="promotionPriceSum" resultType="java.math.BigDecimal">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        sum(to_account_money)
        from trade_detail_share_profit
        where user_type = #{userType} and user_id = #{userId}
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from trade_detail_share_profit
        where id = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from trade_detail_share_profit
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.edaochina.shopping.domain.entity.trade.TradeDetailShareProfit">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into trade_detail_share_profit (id, order_id, user_type,
        user_id, share_profit, to_account_money,
        create_time, update_time)
        values (#{id,jdbcType=INTEGER}, #{orderId,jdbcType=VARCHAR}, #{userType,jdbcType=TINYINT},
        #{userId,jdbcType=VARCHAR}, #{shareProfit,jdbcType=DECIMAL}, #{toAccountMoney,jdbcType=DECIMAL},
        #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.edaochina.shopping.domain.entity.trade.TradeDetailShareProfit">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into trade_detail_share_profit
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="orderId != null">
                order_id,
            </if>
            <if test="userType != null">
                user_type,
            </if>
            <if test="userId != null">
                user_id,
            </if>
            <if test="shareProfit != null">
                share_profit,
            </if>
            <if test="toAccountMoney != null">
                to_account_money,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="orderId != null">
                #{orderId,jdbcType=VARCHAR},
            </if>
            <if test="userType != null">
                #{userType,jdbcType=TINYINT},
            </if>
            <if test="userId != null">
                #{userId,jdbcType=VARCHAR},
            </if>
            <if test="shareProfit != null">
                #{shareProfit,jdbcType=DECIMAL},
            </if>
            <if test="toAccountMoney != null">
                #{toAccountMoney,jdbcType=DECIMAL},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective"
            parameterType="com.edaochina.shopping.domain.entity.trade.TradeDetailShareProfit">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update trade_detail_share_profit
        <set>
            <if test="orderId != null">
                order_id = #{orderId,jdbcType=VARCHAR},
            </if>
            <if test="userType != null">
                user_type = #{userType,jdbcType=TINYINT},
            </if>
            <if test="userId != null">
                user_id = #{userId,jdbcType=VARCHAR},
            </if>
            <if test="shareProfit != null">
                share_profit = #{shareProfit,jdbcType=DECIMAL},
            </if>
            <if test="toAccountMoney != null">
                to_account_money = #{toAccountMoney,jdbcType=DECIMAL},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.edaochina.shopping.domain.entity.trade.TradeDetailShareProfit">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update trade_detail_share_profit
        set order_id = #{orderId,jdbcType=VARCHAR},
        user_type = #{userType,jdbcType=TINYINT},
        user_id = #{userId,jdbcType=VARCHAR},
        share_profit = #{shareProfit,jdbcType=DECIMAL},
        to_account_money = #{toAccountMoney,jdbcType=DECIMAL},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        update_time = #{updateTime,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <select id="getShareProfitList" resultMap="SysShareProfitVoMap">
        SELECT t.id,o.id AS order_id,o.`shoper_id` AS merchant_id
        ,o.`goods_name`,o.`goods_num` AS buy_num
        ,CASE WHEN o.collect_flag = 1 THEN 1 when g.supply_chain = 1 then 2 WHEN g.hot = 1 THEN 3 ELSE 4 END AS
        goods_type
        ,o.actual_price AS order_price ,t.to_account_money AS profit_free,t.create_time AS profit_time
        ,o.create_time,o.share_merchant_id
        FROM trade_detail_share_profit t,order_main o
        ,goods g
        <if test="countyId != null and countyId != ''">
            ,sys_user_merchant su
        </if>
        WHERE t.`order_id` = o.id
        AND t.`user_type` = #{roleId}
        <if test="userId != null and userId != ''">
            AND t.`user_id` = #{userId}
        </if>
        <if test="goodsName != null and goodsName != ''">
            AND o.`goods_name` LIKE "%"#{goodsName}"%"
        </if>
        <if test="merchantId != null and merchantId != ''">
            AND o.`shoper_id` LIKE "%"#{merchantId}"%"
        </if>
        <if test="beginTime != null">
            AND t.`create_time` > #{beginTime}
        </if>
        <if test="endTime != null">
            AND #{endTime} > t.`create_time`
        </if>

        <if test="countyId != null and countyId != ''">
            AND su.`county_id` = #{countyId}
            AND su.id = o.`shoper_id`
        </if>
        AND g.id = o.`goods_id`
        <if test="goodsTypeId != null and goodsTypeId != ''">
            and g.goods_type_id = #{goodsTypeId}
        </if>
        <if test="goodsSubClassId != null and goodsSubClassId != ''">
            and g.goods_subclass_id = #{goodsSubClassId}
        </if>
        <choose>
            <when test="orderType != null and orderType == 1">
                and o.collect_flag = 1
            </when>
            <when test="orderType != null and orderType == 2">
                and g.supply_chain = 1
            </when>
            <when test="orderType != null and orderType == 3">
                and g.hot = 1
                and g.supply_chain = 0
            </when>
        </choose>
        order by t.create_time desc
    </select>

    <select id="getShareByRoleAndUserId" resultType="java.math.BigDecimal">
        select sum(to_account_money)
        from trade_detail_share_profit
        where user_type = #{roleId}
        and user_id = #{userId}
        and #{endTime} > create_time
        and create_time > #{beginTime}
    </select>
</mapper>